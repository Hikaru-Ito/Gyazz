//doctype html !!! これがあると動かない!
html
  head
    meta(charset='utf-8')
    title #{wiki} / #{title}
    link(rel="stylesheet",href="/stylesheets/gyazz.css",type="text/css")
    link(rel="stylesheet",href="/stylesheets/tipTip.css",type="text/css")
    link(rel="apple-touch-icon",href="/gyazz.png")
    link(rel="shortcut icon",href="/favicon.ico")
    link(rel="alternate",type="application/rss+xml",title="#{title} RSS Feed",href="#{wiki}/rss.xml")
    meta(name="robots",content="page.wiki[searchable] ? index,follow : noindex,nofollow")

    script(src='/javascripts/pbsearch.js')
    script(src='/javascripts/pbdict.js')
    script(src='/javascripts/utf.js')
    script(src='/javascripts/md5.js')
    script(src="/javascripts/jquery.js")
    script(src='/javascripts/jQuery.kill_referrer.js')
    script(src='/javascripts/jquery.tipTip.js')
    script(src='/javascripts/underscore.js')

    script(src='/socket.io/socket.io.js')

    script(src='/javascripts/coffee-script.js')
    // この下ので動いてほしいのだがうまくいかない 2014/07/22 19:20:36
    //script(type='text/coffeescript', src='/javascripts/gyazz_lib.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_tag.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_buffer.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_related.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_notification.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_upload.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_display.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_socket.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz_location.coffee')
    //script(type='text/coffeescript', src='/javascripts/gyazz.coffee')

    // こちらは動く
    script(src='/javascripts/gyazz_lib.js')
    script(src='/javascripts/gyazz_tag.js')
    script(src='/javascripts/gyazz_buffer.js')
    script(src='/javascripts/gyazz_related.js')
    script(src='/javascripts/gyazz_notification.js')
    script(src='/javascripts/gyazz_upload.js')
    script(src='/javascripts/gyazz_display.js')
    script(src='/javascripts/gyazz_socket.js')
    script(src='/javascripts/gyazz_location.js')
    script(src='/javascripts/gyazz.js')

    script.
      var wiki = "#{wiki}"; // escape_jsvar
      var title = "#{title}"; // escape_jsvar
      var do_auth = false;
      var writable = true;
  body
    - var writable = true;
    div.title
      span.wordtitle
        img#historyimage(src="/#{wiki}/#{title}/modify.png",height=18,width=80)
        // sanitize必要!!!
        if writable
          a#title(href="/#{wiki}/#{title}/__edit") #{title}
        else
          | #{title}

      span#debug

      form(action="/__search/#{wiki}",method="get",style="float:right;font-size:12pt;")
        input#search(height='20', name='q', type='text', value="#{query}")
        input(type='submit', value='リスト/検索')
    
      span#datestr.language

    #rawdata rawdata: @page.text.gsub

    p

    div#filterdiv
      | Search:
      input#filter(type="text", autocomplete="off",
        style="font-size:10pt;border:none;padding:1px;margin:0;background-color:#f0f0ff;")

    #contents

    // テキスト入力はすべてこのinputを使っているが、毎回生成する方が良いかもしれない
    input#editline(autocomplete='off', type='text', style='visibility:hidden;')

    p

    #links.links

    script(src="http://maps.googleapis.com/maps/api/js?sensor=false")
